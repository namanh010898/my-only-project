@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@{
    ViewData["Title"] = "Tạo mới sự kiện";
    Layout = "_Layout - Admin";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CKEditor</title>
    <script src="https://cdn.ckeditor.com/ckeditor5/33.0.0/classic/ckeditor.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <style>
        .modal-footer .btn + .btn {
            margin-bottom: 10px;
        }

        #example_wrapper {
            display : block;
        }

        /* Giao diện modal */
        input.fullwidth {
            width : 100%;
        }

        #closing-modal-black:hover {
            color :#333 !important;
        }

        .modal-row-menu {
            margin-top : 13px;
        }
    </style>

</head>

<body>
    <div class="" id="">
        <div class="modal-dialog modal-lg novaticeditForm">
            <div class="modal-content">
                <div class="modal-header bg-gradient-info">
                    <h4 class="modal-title">
                        <i class="fa fa-edit"></i> <span id="updateTitle">Thêm sự kiện mới</span>
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="container" style="display: contents"> 
                
                    <h3>Sự kiện</h3>
                    <i>Lưu ý điền đầy đủ các thông tin có dấu <span style="color:red">*</span></i>
                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="ID">ID(Tự động)</label><span style="color:red">*</span>
                        </div>
                        <div class="col-md-9">
                            <input type="text" id="ID" class="fullwidth"  disabled />
                        </div>
                    </div>

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="Name">Name</label><span style="color:red">*</span>
                        </div>
                        <div class="col-md-9">
                            <input type="text" id="Name" class="fullwidth"   />
                        </div>
                    </div>

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="PostCategoryID">Category(Tự động)</label><span style="color:red">*</span> 
                        </div>
                        <div class="col-md-9">
                            <select id="PostCategoryID" disabled>
                                <option value="1">Tin tức</option>
                                <option value="2">Tin tức hợp tác</option>
                                <option value="3" selected>Sự kiện</option>
                            </select>
                        </div>
                    </div> 

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="Active">Active(Tự động)</label><span style="color:red">*</span> 
                        </div>
                        <div class="col-md-9">
                            <select id="Active" disabled>
                                <option value="1">Public</option>
                                <option value="0">Private</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="PostCommentStatusID">Comment</label><span style="color:red">*</span>
                        </div>
                        <div class="col-md-9">
                            <select id="PostCommentStatusID">
                                <option value="1">Public</option>
                                <option value="0">Private</option>
                            </select>
                        </div>
                    </div>  
                     
                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="Photo">Photo</label>
                        </div>
                        <div class="col-md-9">
                            <input type="text" id="Photo" class="fullwidth"  />
                        </div>
                    </div> 

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="Description">Description</label>
                        </div>
                        <div class="col-md-9">
                            <input type="text" id="Description" class="fullwidth"   />
                        </div>
                    </div>
                    
                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="Content">Content<span style="color:red">*</span></label>
                        </div>
                        <div class="col-md-9">
                            <div id="Content" class="Text"></div>
                        </div>
                    </div> 
                        


                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="PublishedTime">Published Time<span style="color:red">*</span></label>
                        </div>
                        <div class="col-md-9">
                            <input type="datetime-local" id="PublishedTime" />
                        </div>
                    </div> 

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="OpenTime">Open Time<span style="color:red">*</span></label>
                        </div>
                        <div class="col-md-9">
                            <input type="datetime-local" id="OpenTime" />
                        </div>
                    </div> 

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="ClosedTime">Closed Time<span style="color:red">*</span></label>
                        </div>
                        <div class="col-md-9">
                            <input type="datetime-local" id="ClosedTime" />
                        </div>
                    </div> 

                    <div class="row modal-row-menu">
                        <div class="col-md-3 ">
                        <label for="EventAddress">Event Address<span style="color:red">*</span></label>
                        </div>
                        <div class="col-md-9">
                            <input type="text" id="EventAddress" class="fullwidth"   />
                        </div>
                    </div> 
                      
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" style="display:none" class="btn btn-default" data-dismiss="modal">
                        Close
                    </button>
                    <button type="button" class="btn btn-primary" id="btnUpdateItem"
                            onclick="Submit()">
                        Tạo mới
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // js for description editor 
        var posttext;
        ClassicEditor
            .create(document.querySelector('#Content'))
            .then(editor => {
                posttext = editor
            })
            .catch(error => {
                console.error(error);
            });
    </script>
    <script>  
             
        function Submit() { 

            var resultSubmit = true; 
             
            if( $("#Name").val().trim() == "" ||  $("#Name").val() == null) {
                resultSubmit = false;
                Swal.fire({
                icon: 'warning',
                title: 'Cần điền đầy đủ thông tin!',
                text: 'Name không thể bị bỏ trống',
                showCloseButton: true
                });
            }
             

            if( $("#PublishedTime").val() == "" ||  $("#PublishedTime").val() == null) {
                resultSubmit = false;
                Swal.fire({
                icon: 'warning',
                title: 'Cần điền đầy đủ thông tin!',
                text: 'Published Time không thể bị bỏ trống',
                showCloseButton: true
                });
            }

            if( $("#OpenTime").val() == "" ||  $("#OpenTime").val() == null) {
                resultSubmit = false;
                Swal.fire({
                icon: 'warning',
                title: 'Cần điền đầy đủ thông tin!',
                text: 'Open Time không thể bị bỏ trống',
                showCloseButton: true
                });
            }

            if( $("#ClosedTime").val() == "" ||  $("#ClosedTime").val() == null) {
                resultSubmit = false;
                Swal.fire({
                icon: 'warning',
                title: 'Cần điền đầy đủ thông tin!',
                text: 'Closed Time không thể bị bỏ trống',
                showCloseButton: true
                });
            }

            if( $("#EventAddress").val().trim() == "" ||  $("#EventAddress").val() == null) {
                resultSubmit = false;
                Swal.fire({
                icon: 'warning',
                title: 'Cần điền đầy đủ thông tin!',
                text: 'Event Address không thể bị bỏ trống',
                showCloseButton: true
                });
            }

            // check thoả mãn các điều kiện trước khi tạo
            if(resultSubmit) {
                Swal.fire({
                icon: 'question',
                title: 'Confirm?',
                text: 'Bạn có muốn tạo mới sự kiện '+ $("#Name").val() +' không?',
                showCloseButton: true,
                showCancelButton: true
            }).then((result) => {
                if (result.isConfirmed) {
                    var data = posttext.getData();
                    var pubtime = "";  
                    debugger;
                    var obj = {
                        "PostTypeID": 1,
                        "PostAccountID": 10001,
                        "PostCategoryID" :  $("#PostCategoryID").val(),  
                        "PostLayoutID": 1,
                        "PostPublishStatusID": 1,
                        "PostCommentStatusID": $("#PostCommentStatusID").val(),             
                        "Active":  $("#Active").val(),      
                        "Url": "",
                        "Photo": $("#Photo").val(),     
                        "Video": "",
                        "Name": $("#Name").val(),       
                        "Description": $("#Description").val(),     
                        "Text": data,       
                        "PublishedTime": $("#PublishedTime").val(),        
                        "OpenTime": $("#OpenTime").val(),        
                        "ClosedTime": $("#ClosedTime").val(),        
                        "EventAddress": $("#EventAddress").val(),        

                    } 
                    $.ajax({
                        url: "/post/api/add",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(obj),
                        success: function (responseData) {
                            Swal.fire({
                                title: '<strong>Đã tạo sự kiện mới thành công!</strong>',
                                icon: 'success',
                                showCloseButton: true,
                                focusConfirm: false,
                            }).then(resultt => {
                                if (resultt.isConfirmed) {
                                    window.location.href = "/post/admin/listevents";
                                }
                            });
                        }
                    })
                } else if (result.isDenied) {
                    
                    print(e);
                }
            })
            }
            
        }
    </script>
</body>
</html>